<div class="details-overlay" (click)="closePanel()">
  <div class="details-panel" (click)="$event.stopPropagation()">
    <!-- Panel Header -->
    <div class="panel-header">
      <h2>Subscriber Details</h2>
      <button class="close-btn" (click)="closePanel()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
    <div class="panel-body">
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading subscriber details...</p>
      </div>
    </div>
    }

    <!-- Error State -->
    @if (!isLoading && error) {
    <div class="panel-body">
      <div class="alert alert-error">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </svg>
        {{ error }}
      </div>
      <div class="error-actions">
        <button class="btn btn-primary" (click)="retryLoad()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10" />
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
          </svg>
          Retry
        </button>
      </div>
    </div>
    }

    <!-- Subscriber Details -->
    @if (!isLoading && !error && subscriber) {
    <div class="panel-body">
      <!-- Status Badge -->
      <div class="status-section">
        @if (subscriber.isActive) {
        <span class="badge badge-success badge-lg">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12" />
          </svg>
          Active Subscriber
        </span>
        } @else {
        <span class="badge badge-danger badge-lg">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="15" y1="9" x2="9" y2="15" />
            <line x1="9" y1="9" x2="15" y2="15" />
          </svg>
          Inactive
        </span>
        }
      </div>

      <!-- Basic Information -->
      <div class="info-section">
        <h3 class="section-title">Basic Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                <polyline points="22,6 12,13 2,6" />
              </svg>
            </div>
            <div class="info-content">
              <span class="info-label">Email Address</span>
              <span class="info-value">{{ subscriber.email }}</span>
            </div>
          </div>

          @if (subscriber.name) {
          <div class="info-item">
            <div class="info-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
              </svg>
            </div>
            <div class="info-content">
              <span class="info-label">Name</span>
              <span class="info-value">{{ subscriber.name }}</span>
            </div>
          </div>
          }

          <div class="info-item">
            <div class="info-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                <line x1="12" y1="22.08" x2="12" y2="12" />
              </svg>
            </div>
            <div class="info-content">
              <span class="info-label">Source</span>
              <span class="info-value">{{ subscriber.source || 'Direct' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Subscription Timeline -->
      <div class="info-section">
        <h3 class="section-title">Subscription Timeline</h3>
        <div class="timeline">
          <div class="timeline-item">
            <div class="timeline-marker timeline-marker-primary"></div>
            <div class="timeline-content">
              <span class="timeline-label">Subscribed On</span>
              <span class="timeline-value">{{ formatDate(subscriber.subscribedAt) }}</span>
            </div>
          </div>

          @if (subscriber.unsubscribedAt) {
          <div class="timeline-item">
            <div class="timeline-marker timeline-marker-danger"></div>
            <div class="timeline-content">
              <span class="timeline-label">Unsubscribed On</span>
              <span class="timeline-value">{{ formatDate(subscriber.unsubscribedAt) }}</span>
            </div>
          </div>
          }

          <div class="timeline-item">
            <div class="timeline-marker timeline-marker-info"></div>
            <div class="timeline-content">
              <span class="timeline-label">Subscription Duration</span>
              <span class="timeline-value">{{ getSubscriptionDuration() }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity Summary -->
      <div class="info-section">
        <h3 class="section-title">Activity Summary</h3>
        <div class="activity-stats">
          <div class="activity-stat">
            <div class="stat-icon-small">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
              </svg>
            </div>
            <div>
              <span class="stat-label">Member Since</span>
              <span class="stat-value">{{ formatShortDate(subscriber.subscribedAt) }}</span>
            </div>
          </div>

          <div class="activity-stat">
            <div class="stat-icon-small">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                @if (subscriber.isActive) {
                <polyline points="12 6 12 12 16 14" />
                } @else {
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
                }
              </svg>
            </div>
            <div>
              <span class="stat-label">Current Status</span>
              <span class="stat-value">{{ subscriber.isActive ? 'Active' : 'Inactive' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Additional Info -->
      <div class="info-section">
        <h3 class="section-title">System Information</h3>
        <div class="system-info">
          <div class="system-info-row">
            <span class="system-label">Subscriber ID</span>
            <span class="system-value">{{ subscriber.id }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel Footer -->
    <div class="panel-footer">
      <button class="btn btn-secondary" (click)="closePanel()">Close</button>
    </div>
    }
  </div>
</div>